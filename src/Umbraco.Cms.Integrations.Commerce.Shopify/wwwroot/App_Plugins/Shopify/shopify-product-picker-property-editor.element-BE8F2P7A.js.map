{"version":3,"file":"shopify-product-picker-property-editor.element-BE8F2P7A.js","sources":["../../../Client/src/modal/shopify.modal-token.ts","../../../Client/src/property-editor/shopify-product-picker-property-editor.element.ts"],"sourcesContent":["import { UmbModalToken } from \"@umbraco-cms/backoffice/modal\";\r\nimport type { ProductDtoModel } from \"@umbraco-integrations/shopify/generated\";\r\n\r\nexport type ShopifyProductPickerModalData = {\r\n    headline: string;\r\n}\r\n\r\nexport type ShopifyProductPickerModalValue = {\r\n    products: ProductDtoModel;\r\n}\r\n\r\nexport const SHOPIFY_MODAL_TOKEN = new UmbModalToken<ShopifyProductPickerModalData, ShopifyProductPickerModalValue>(\"Shopify.Modal\", {\r\n    modal: {\r\n        type: \"sidebar\",\r\n        size: \"small\"\r\n    }\r\n});","import { UmbElementMixin } from '@umbraco-cms/backoffice/element-api';\r\nimport { LitElement, customElement, html, css, property, state } from \"@umbraco-cms/backoffice/external/lit\";\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from \"@umbraco-cms/backoffice/modal\";\r\nimport {\r\n    UMB_NOTIFICATION_CONTEXT,\r\n} from \"@umbraco-cms/backoffice/notification\";\r\nimport { SHOPIFY_MODAL_TOKEN } from \"../modal/shopify.modal-token\";\r\nimport { ConfigDescription, type ShopifyServiceStatus } from \"../models/shopify-service.model\";\r\nimport { SHOPIFY_CONTEXT_TOKEN } from \"../context/shopify.context\";\r\nimport type { ProductDtoModel } from \"@umbraco-integrations/shopify/generated\";\r\n\r\nconst elementName = \"shopify-picker\";\r\nexport class ShopifyProductPickerPropertyEditor extends UmbElementMixin(LitElement){\r\n    #modalManagerContext?: typeof UMB_MODAL_MANAGER_CONTEXT.TYPE;\r\n    #shopifyContext!: typeof SHOPIFY_CONTEXT_TOKEN.TYPE;\r\n\r\n    @property({ type: String })\r\n    public value = \"\";\r\n\r\n    @state()\r\n    private products: Array<ProductDtoModel> = [];\r\n\r\n    @state()\r\n    private _serviceStatus: ShopifyServiceStatus = {\r\n        isValid: false,\r\n        type: \"\",\r\n        description: \"\",\r\n        useOAuth: false\r\n    };\r\n\r\n    constructor() {\r\n        super();\r\n        this.consumeContext(UMB_MODAL_MANAGER_CONTEXT, (instance) => {\r\n            this.#modalManagerContext = instance;\r\n        });\r\n        this.consumeContext(SHOPIFY_CONTEXT_TOKEN, (context) => {\r\n            this.#shopifyContext = context;\r\n        });\r\n    }\r\n\r\n    async connectedCallback() {\r\n        super.connectedCallback();\r\n\r\n        if (this.value == null || this.value.length == 0) return;\r\n\r\n        const { data } = await this.#shopifyContext.checkConfiguration();\r\n        if (!data || !data.type?.value) return;\r\n\r\n        this._serviceStatus = {\r\n            isValid: data.isValid,\r\n            type: data.type.value,\r\n            description: \"\",\r\n            useOAuth: data.isValid && data.type.value === \"OAuth\"\r\n        }\r\n\r\n        if (!this._serviceStatus.isValid) {\r\n            this._showError(ConfigDescription.none);\r\n        }\r\n\r\n        const dto: Array<ProductDtoModel> = JSON.parse(JSON.stringify(this.value));\r\n        this.products = dto;\r\n    }\r\n\r\n    private async _openModal() {\r\n        const pickerContext = this.#modalManagerContext?.open(this, SHOPIFY_MODAL_TOKEN, {\r\n            data: {\r\n                headline: \"HubSpot Forms\",\r\n            },\r\n        });\r\n\r\n        const data = await pickerContext?.onSubmit();\r\n        if (!data) return;\r\n\r\n        this.value = JSON.stringify(data.products);\r\n        console.log(this.value);\r\n        this.dispatchEvent(new CustomEvent('property-value-change'));\r\n    }\r\n\r\n    private async _showError(message: string) {\r\n        const notificationContext = await this.getContext(UMB_NOTIFICATION_CONTEXT);\r\n        notificationContext?.peek(\"danger\", {\r\n            data: { message: message },\r\n        });\r\n    }\r\n\r\n    render() {\r\n        return html`\r\n            ${this.value == null || this.value.length == 0\r\n                ? html`\r\n                    <uui-button\r\n\t\t\t\t        class=\"add-button\"\r\n\t\t\t\t        @click=${this._openModal}\r\n\t\t\t\t        label=${this.localize.term('general_add')}\r\n\t\t\t\t        look=\"placeholder\"></uui-button>\r\n                `\r\n                : html`\r\n                    <div></div>\r\n                `}\r\n\t\t`;\r\n    }\r\n\r\n    static styles = [\r\n        css`\r\n            .add-button {\r\n                width: 100%;\r\n            }\r\n        `];\r\n}\r\n\r\n\r\nexport default ShopifyProductPickerPropertyEditor;\r\n\r\ndeclare global {\r\n    interface HTMLElementTagNameMap {\r\n        [elementName]: ShopifyProductPickerPropertyEditor;\r\n    }\r\n}"],"names":["SHOPIFY_MODAL_TOKEN","UmbModalToken","_ShopifyProductPickerPropertyEditor","UmbElementMixin","LitElement","__privateAdd","_modalManagerContext","_shopifyContext","UMB_MODAL_MANAGER_CONTEXT","instance","__privateSet","SHOPIFY_CONTEXT_TOKEN","context","data","__privateGet","_a","ConfigDescription","dto","pickerContext","message","notificationContext","UMB_NOTIFICATION_CONTEXT","html","css","ShopifyProductPickerPropertyEditor","__decorateClass","property","state"],"mappings":";;;;;;;;;;;AAWa,MAAAA,IAAsB,IAAIC,EAA6E,iBAAiB;AAAA,EACjI,OAAO;AAAA,IACH,MAAM;AAAA,IACN,MAAM;AAAA,EACV;AACJ,CAAC;;;;;;ACJY,MAAAC,IAAA,MAAAA,UAA2CC,EAAgBC,CAAU,EAAC;AAAA,EAkB/E,cAAc;AACJ;AAlBV,IAAAC,EAAA,MAAAC;AACA,IAAAD,EAAA,MAAAE;AAGA,SAAO,QAAQ,IAGf,KAAQ,WAAmC,IAG3C,KAAQ,iBAAuC;AAAA,MAC3C,SAAS;AAAA,MACT,MAAM;AAAA,MACN,aAAa;AAAA,MACb,UAAU;AAAA,IAAA,GAKL,KAAA,eAAeC,GAA2B,CAACC,MAAa;AACzD,MAAAC,EAAA,MAAKJ,GAAuBG;AAAA,IAAA,CAC/B,GACI,KAAA,eAAeE,GAAuB,CAACC,MAAY;AACpD,MAAAF,EAAA,MAAKH,GAAkBK;AAAA,IAAA,CAC1B;AAAA,EACL;AAAA,EAEA,MAAM,oBAAoB;;AAGtB,QAFA,MAAM,kBAAkB,GAEpB,KAAK,SAAS,QAAQ,KAAK,MAAM,UAAU,EAAG;AAElD,UAAM,EAAE,MAAAC,EAAK,IAAI,MAAMC,EAAA,MAAKP,GAAgB,mBAAmB;AAC/D,QAAI,CAACM,KAAQ,GAACE,IAAAF,EAAK,SAAL,QAAAE,EAAW,OAAO;AAEhC,SAAK,iBAAiB;AAAA,MAClB,SAASF,EAAK;AAAA,MACd,MAAMA,EAAK,KAAK;AAAA,MAChB,aAAa;AAAA,MACb,UAAUA,EAAK,WAAWA,EAAK,KAAK,UAAU;AAAA,IAAA,GAG7C,KAAK,eAAe,WAChB,KAAA,WAAWG,EAAkB,IAAI;AAG1C,UAAMC,IAA8B,KAAK,MAAM,KAAK,UAAU,KAAK,KAAK,CAAC;AACzE,SAAK,WAAWA;AAAA,EACpB;AAAA,EAEA,MAAc,aAAa;;AACvB,UAAMC,KAAgBH,IAAAD,EAAA,MAAKR,OAAL,gBAAAS,EAA2B,KAAK,MAAMf,GAAqB;AAAA,MAC7E,MAAM;AAAA,QACF,UAAU;AAAA,MACd;AAAA,IAAA,IAGEa,IAAO,OAAMK,KAAA,gBAAAA,EAAe;AAClC,IAAKL,MAEL,KAAK,QAAQ,KAAK,UAAUA,EAAK,QAAQ,GACjC,QAAA,IAAI,KAAK,KAAK,GACtB,KAAK,cAAc,IAAI,YAAY,uBAAuB,CAAC;AAAA,EAC/D;AAAA,EAEA,MAAc,WAAWM,GAAiB;AACtC,UAAMC,IAAsB,MAAM,KAAK,WAAWC,CAAwB;AAC1E,IAAAD,KAAA,QAAAA,EAAqB,KAAK,UAAU;AAAA,MAChC,MAAM,EAAE,SAAAD,EAAiB;AAAA,IAAA;AAAA,EAEjC;AAAA,EAEA,SAAS;AACE,WAAAG;AAAA,cACD,KAAK,SAAS,QAAQ,KAAK,MAAM,UAAU,IACvCA;AAAA;AAAA;AAAA,qBAGG,KAAK,UAAU;AAAA,oBAChB,KAAK,SAAS,KAAK,aAAa,CAAC;AAAA;AAAA,oBAGnCA;AAAA;AAAA,iBAED;AAAA;AAAA,EAEb;AAQJ;AA9FIhB,IAAA,eACAC,IAAA,eAuFAL,EAAO,SAAS;AAAA,EACZqB;AAAA;AAAA;AAAA;AAAA;AAAA;AA1FK,IAAAC,IAAAtB;AAKFuB,EAAA;AAAA,EADNC,EAAS,EAAE,MAAM,QAAQ;AAAA,GAJjBF,EAKF,WAAA,OAAA;AAGCC,EAAA;AAAA,EADPE,EAAM;AAAA,GAPEH,EAQD,WAAA,UAAA;AAGAC,EAAA;AAAA,EADPE,EAAM;AAAA,GAVEH,EAWD,WAAA,gBAAA;"}